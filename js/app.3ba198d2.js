(function(){"use strict";var t={4541:function(t,e,s){var o=s(7195),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app",attrs:{id:"app"}},[e("AppMenu"),e("AppMap"),t.$store.state.popup.isOpen?e("AppPopup"):t._e()],1)},r=[],a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-map",attrs:{id:"map"}})},i=[],p=s(6158),c=s.n(p),u={name:"AppMap",props:{msg:String},data(){return{accessToken:"pk.eyJ1Ijoicm9tYW5vdjEiLCJhIjoiY2xqbjJtNWMyMWMzZzNxazJjemh5bmxreiJ9.l3GIkp0IhuNqHbmwN3W-zw",map:null,myPoints:{type:"geojson",data:{type:"FeatureCollection",features:[]}},layer:{id:"points",type:"circle",source:"points",layout:{},paint:{"circle-color":["get","color"],"circle-radius":10}},featID:null}},watch:{"$store.state.search":function(){this.myPoints.data.features=this.arrayStations,this.map.removeLayer("points"),this.map.removeSource("points"),this.map.addSource("points",this.myPoints),this.map.addLayer(this.layer)}},computed:{arrayStations(){return this.$store.getters["getStationsWithBranchColor"]}},methods:{initMap(){c().accessToken=this.accessToken,this.map=new(c().Map)({container:"map",style:"mapbox://styles/mapbox/dark-v10",center:[37.617698,55.755864],zoom:11,projection:"globe"})}},async mounted(){await this.$store.dispatch("getBranches"),this.myPoints.data.features=this.arrayStations,this.initMap(),this.map.on("load",(async()=>{this.map.setFog({}),this.map.addSource("points",this.myPoints),this.map.addLayer(this.layer),this.map.on("click","points",(t=>{const e=this.arrayStations.find((e=>JSON.stringify([e.geometry.coordinates[0].toFixed(2),e.geometry.coordinates[1].toFixed(2)])===JSON.stringify([t.lngLat.lng.toFixed(2),t.lngLat.lat.toFixed(2)])));this.$store.dispatch("popupUpdate",{isOpen:!0,content:{...e}})})),this.map.on("mousemove","points",(()=>{this.map.getCanvas().style.cursor="pointer",this.featID&&this.map.removeFeatureState({source:"points",id:this.featID}),this.map.setFeatureState({source:"points",id:this.featID},{hover:!0})}))})),this.map.on("mouseleave","points",(()=>{this.featID&&this.map.setFeatureState({source:"points",id:this.featID},{hover:!1}),this.featID=null,this.map.getCanvas().style.cursor=""}))},unmounted(){this.map.remove(),this.map=null}},l=u,d=s(1001),m=(0,d.Z)(l,a,i,!1,null,null,null),h=m.exports,f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-menu"},[e("div",{staticClass:"app-menu__search-wrap"},[e("input",{staticClass:"app-menu__search",attrs:{type:"text"},on:{input:t.updateFilterValue}})]),t.stations?e("div",{staticClass:"app-menu__list"},t._l(t.stations,(function(s,o){return e("div",{key:o,staticClass:"app-menu__item"},[e("div",{staticClass:"app-menu__item-thumb",style:{backgroundColor:s.properties.color}}),s.properties.name?e("div",{staticClass:"app-menu__item-title",domProps:{innerHTML:t._s(s.properties.name)}}):t._e(),e("a",{staticClass:"app-menu__item-clicker",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openPopup(s)}}})])})),0):t._e()])},_=[],v={name:"AppMenu",props:{msg:String},data(){return{myStations:[]}},methods:{openPopup(t){this.$store.dispatch("popupUpdate",{isOpen:!0,content:{...t}})},updateFilterValue(t){this.$store.commit("UPDATE_SEARCH",t.target.value)}},computed:{stations(){return this.$store.getters["getStationsWithBranchColor"]}}},y=v,C=(0,d.Z)(y,f,_,!1,null,null,null),g=C.exports,P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"popup"},[e("div",{staticClass:"popup__wrap"},[e("div",{staticClass:"popup__content col"},[e("div",{staticClass:"popup__close close-btn",on:{click:function(e){return t.hidePopup()}}},[t._v("X")]),t.$store.state.popup.content?e("div",{staticClass:"popup__content-wrapper"},[t.$store.state.popup.content.properties.color?e("div",{staticClass:"popup__marker",style:{backgroundColor:t.$store.state.popup.content.properties.color}}):t._e(),e("div",{staticClass:"popup__name",domProps:{innerHTML:t._s(t.$store.state.popup.content.properties.name)}}),e("div",{staticClass:"popup__disctrict",domProps:{innerHTML:t._s(t.$store.state.popup.content.properties.district)}}),e("div",{staticClass:"popup__status",domProps:{innerHTML:t._s(t.$store.state.popup.content.properties.status)}}),e("div",{staticClass:"popup__area",domProps:{innerHTML:t._s(t.$store.state.popup.content.properties.admArea)}})]):t._e()]),e("div",{staticClass:"popup__shade",on:{click:function(e){return t.hidePopup()}}})])])},b=[],w={methods:{hidePopup:function(){this.$store.dispatch("popupUpdate",!1),document.body.classList.remove("no-scroll")},escHandler:function(t){"Escape"===t.key&&this.hidePopup()}},mounted:function(){document.body.classList.add("no-scroll"),document.addEventListener("keydown",this.escHandler)}},S=w,k=(0,d.Z)(S,P,b,!1,null,null,null),A=k.exports,x={name:"App",components:{AppMap:h,AppMenu:g,AppPopup:A}},L=x,O=(0,d.Z)(L,n,r,!1,null,null,null),M=O.exports,$=s(408);o.ZP.use($.ZP);var T=new $.ZP.Store({state:{branches:null,enableFilter:!1,search:"",popup:{isOpen:!1}},actions:{popupUpdate(t,e){this.commit("POPUP_UPDATE",e)},async getBranches({commit:t}){return new Promise(((e,s)=>{fetch("./content/branches.json").then((t=>t.json())).then((s=>{t("UPDATE_BRANCHES",s),e()})).catch((t=>{console.error("Error:",t),s()}))}))}},mutations:{UPDATE_BRANCHES(t,e){t.branches=e},UPDATE_SEARCH(t,e){t.search=e},POPUP_UPDATE(t,e){t.popup=e}},getters:{getStationsWithBranchColor(t){if(null==t.branches)return;const e=t.branches.reduce(((t,e)=>{const s=e.stations.map((t=>{let s={type:"Feature",properties:{color:`#${e.hex_color}`,order:t.order,name:t.name,admArea:t.admArea,district:t.district,status:t.status},geometry:{coordinates:[t.lng,t.lat],type:"Point"}};return s}));return t.concat(s)}),[]),s=e.filter((e=>e.properties.name.toLowerCase().includes(t.search.toLowerCase()))),o=function(o){o=""!==t.search?s:e;const n=o.sort(((t,e)=>t.properties.name.toLowerCase()<e.properties.name.toLowerCase()?-1:t.properties.name.toLowerCase()>e.properties.name.toLowerCase()?1:0));return n};return o()}}});o.ZP.config.productionTip=!1,new o.ZP({store:T,render:t=>t(M)}).$mount("#app")}},e={};function s(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,s),r.exports}s.m=t,function(){var t=[];s.O=function(e,o,n,r){if(!o){var a=1/0;for(u=0;u<t.length;u++){o=t[u][0],n=t[u][1],r=t[u][2];for(var i=!0,p=0;p<o.length;p++)(!1&r||a>=r)&&Object.keys(s.O).every((function(t){return s.O[t](o[p])}))?o.splice(p--,1):(i=!1,r<a&&(a=r));if(i){t.splice(u--,1);var c=n();void 0!==c&&(e=c)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[o,n,r]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,o){var n,r,a=o[0],i=o[1],p=o[2],c=0;if(a.some((function(e){return 0!==t[e]}))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(p)var u=p(s)}for(e&&e(o);c<a.length;c++)r=a[c],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(u)},o=self["webpackChunkmetro"]=self["webpackChunkmetro"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=s.O(void 0,[998],(function(){return s(4541)}));o=s.O(o)})();
//# sourceMappingURL=app.3ba198d2.js.map