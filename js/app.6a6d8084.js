(function(){"use strict";var t={86:function(t,e,s){var n=s(7195),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app",attrs:{id:"app"}},[e("AppMenu"),e("AppMap"),t.$store.state.popup.isOpen?e("AppPopup"):t._e()],1)},r=[],a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-map",attrs:{id:"map"}})},i=[],p=s(6158),u=s.n(p),c={name:"AppMap",props:{msg:String},data(){return{accessToken:"pk.eyJ1Ijoicm9tYW5vdjEiLCJhIjoiY2xqbjJtNWMyMWMzZzNxazJjemh5bmxreiJ9.l3GIkp0IhuNqHbmwN3W-zw",map:null,myPoints:{type:"geojson",data:{type:"FeatureCollection",features:[]}},layer:{id:"points",type:"circle",source:"points",layout:{},paint:{"circle-color":["get","color"],"circle-radius":10}},featID:null}},watch:{"$store.state.search":function(){this.myPoints.data.features=this.arrayStations,this.map.removeLayer("points"),this.map.removeSource("points"),this.map.addSource("points",this.myPoints),this.map.addLayer(this.layer)}},computed:{arrayStations(){return this.$store.getters["getStationsWithBranchColor"]}},methods:{openPopup(){this.$store.dispatch("popupUpdate",!0)},initMap(){u().accessToken=this.accessToken,this.map=new(u().Map)({container:"map",style:"mapbox://styles/mapbox/dark-v10",center:[37.617698,55.755864],zoom:11,projection:"globe"})}},async mounted(){await this.$store.dispatch("getBranches"),this.myPoints.data.features=this.arrayStations,this.initMap(),this.map.on("load",(async()=>{this.map.setFog({}),this.map.addSource("points",this.myPoints),this.map.addLayer(this.layer),this.map.on("click","points",(t=>{console.log(t.lngLat),this.openPopup()})),this.map.on("mousemove","points",(()=>{this.map.getCanvas().style.cursor="pointer",this.featID&&this.map.removeFeatureState({source:"points",id:this.featID}),this.map.setFeatureState({source:"points",id:this.featID},{hover:!0})}))})),this.map.on("mouseleave","points",(()=>{this.featID&&this.map.setFeatureState({source:"points",id:this.featID},{hover:!1}),this.featID=null,this.map.getCanvas().style.cursor=""}))},unmounted(){this.map.remove(),this.map=null}},l=c,h=s(1001),m=(0,h.Z)(l,a,i,!1,null,null,null),d=m.exports,f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-menu"},[e("div",{staticClass:"app-menu__search-wrap"},[e("input",{staticClass:"app-menu__search",attrs:{type:"text"},on:{input:t.updateFilterValue}})]),t.stations?e("div",{staticClass:"app-menu__list"},t._l(t.stations,(function(s,n){return e("div",{key:n,staticClass:"app-menu__item"},[e("div",{staticClass:"app-menu__item-thumb",style:{backgroundColor:s.properties.color}}),s.properties.name?e("div",{staticClass:"app-menu__item-title",domProps:{innerHTML:t._s(s.properties.name)}}):t._e()])})),0):t._e()])},v=[],_={name:"AppMenu",props:{msg:String},data(){return{myStations:[]}},methods:{openPopup(){this.$store.dispatch("popupUpdate",!0)},updateFilterValue(t){this.$store.commit("UPDATE_SEARCH",t.target.value)}},computed:{stations(){return this.$store.getters["getStationsWithBranchColor"]}}},y=_,P=(0,h.Z)(y,f,v,!1,null,null,null),C=P.exports,g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"popup"},[e("div",{staticClass:"popup__wrap"},[e("div",{staticClass:"popup__content col"},[e("div",{staticClass:"popup__close close-btn",on:{click:function(e){return t.hidePopup()}}},[t._v("X")]),e("div",{staticClass:"popup__content-wrapper"},[e("div",{staticClass:"popup__title",domProps:{innerHTML:t._s(t.$store.state.popup.content.title)}})])]),e("div",{staticClass:"popup__shade",on:{click:function(e){return t.hidePopup()}}})])])},b=[],w={methods:{hidePopup:function(){this.$store.dispatch("popupUpdate",!1),document.body.classList.remove("no-scroll")},escHandler:function(t){"Escape"===t.key&&this.hidePopup()}},mounted:function(){document.body.classList.add("no-scroll"),document.addEventListener("keydown",this.escHandler)}},A=w,S=(0,h.Z)(A,g,b,!1,null,null,null),k=S.exports,x={name:"App",components:{AppMap:d,AppMenu:C,AppPopup:k}},L=x,O=(0,h.Z)(L,o,r,!1,null,null,null),j=O.exports,E=s(408);n.ZP.use(E.ZP);var M=new E.ZP.Store({state:{branches:null,enableFilter:!1,search:"",popup:{isOpen:!1,content:{title:"хуй"}}},actions:{popupUpdate(t,e){this.commit("POPUP_UPDATE",e)},async getBranches({commit:t}){return new Promise(((e,s)=>{fetch("./content/branches.json").then((t=>t.json())).then((s=>{t("UPDATE_BRANCHES",s),e()})).catch((t=>{console.error("Error:",t),s()}))}))}},mutations:{UPDATE_BRANCHES(t,e){t.branches=e},UPDATE_SEARCH(t,e){t.search=e},POPUP_UPDATE(t,e){t.popup.isOpen=e}},getters:{getStationsWithBranchColor(t){if(null==t.branches)return;const e=t.branches.reduce(((t,e)=>{const s=e.stations.map((t=>{let s={type:"Feature",properties:{color:`#${e.hex_color}`,order:t.order,name:t.name,admArea:t.admArea,district:t.district,status:t.status},geometry:{coordinates:[t.lng,t.lat],type:"Point"}};return s}));return t.concat(s)}),[]),s=e.filter((e=>e.properties.name.toLowerCase().includes(t.search.toLowerCase()))),n=function(n){n=""!==t.search?s:e;const o=n.sort(((t,e)=>t.properties.name.toLowerCase()<e.properties.name.toLowerCase()?-1:t.properties.name.toLowerCase()>e.properties.name.toLowerCase()?1:0));return o};return n()}}});n.ZP.config.productionTip=!1,new n.ZP({store:M,render:t=>t(j)}).$mount("#app")}},e={};function s(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,s),r.exports}s.m=t,function(){var t=[];s.O=function(e,n,o,r){if(!n){var a=1/0;for(c=0;c<t.length;c++){n=t[c][0],o=t[c][1],r=t[c][2];for(var i=!0,p=0;p<n.length;p++)(!1&r||a>=r)&&Object.keys(s.O).every((function(t){return s.O[t](n[p])}))?n.splice(p--,1):(i=!1,r<a&&(a=r));if(i){t.splice(c--,1);var u=o();void 0!==u&&(e=u)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[n,o,r]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,n){var o,r,a=n[0],i=n[1],p=n[2],u=0;if(a.some((function(e){return 0!==t[e]}))){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(p)var c=p(s)}for(e&&e(n);u<a.length;u++)r=a[u],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(c)},n=self["webpackChunkmetro"]=self["webpackChunkmetro"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(86)}));n=s.O(n)})();
//# sourceMappingURL=app.6a6d8084.js.map